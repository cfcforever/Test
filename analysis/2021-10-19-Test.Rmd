---
title: "2021-10-19-Test"
# author: "cfcforever"
# date: ""
output: 
  workflowr::wflow_html:
    code_folding: hide
editor_options:
  chunk_output_type: console
---

```{r include=FALSE}
source("code/packages_and_functions.R")
load("data/plan/plan_firminy.RData")
```


# load data
```{r}
data = read.csv2("data/json/2021-10-19/0daa.csv")
tag = "0daa"

coord1 = as.data.frame(matrix(c(-7.811,-8.616,
                                -5.811,-8.616,
                                -3.811,-8.616,
                                -1.811,-8.616,
                                 0.189,-8.616,
                                 2.189,-8.616), ncol = 2, byrow = T))
colnames(coord1) = c("x", "y")

coord2 = as.data.frame(matrix(c(-8.752,8.694,
                                -6.752,8.694,
                                -4.752,8.694,
                                -2.752,8.694,
                                -0.752,8.694,
                                 1.248,8.694), ncol = 2, byrow = T))
colnames(coord2) = c("x", "y")

coord3 = as.data.frame(matrix(c(-7.642,-9.007,
                                -7.642,-7.007,
                                -7.642,-5.007,
                                -7.642,-3.007,
                                -7.642,-1.007,
                                -7.642,0.993), ncol = 2, byrow = T))
colnames(coord3) = c("x", "y")
```

![](figure/Wire 2021-10-19 at 11-48-06.jpg){width=50%}


# test 1
![](figure/Wire 2021-10-19 at 17_34.png){width=50%}

## contre le corps
```{r}
dat = data %>%
  filter(H==11 & M>=28 & M<=30)
dat$num = 1:nrow(dat)

steps = dat$num
q <- p + 
  geom_point(data = dat, aes(x=x, y=y), col="red", size=0.5) + 
  geom_point(data = coord1, aes(x=x,y=y), col = "black", size=1) +
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-15,10)) + 
  labs(x="", y="", title = "0daa: 11H28 - 11H30")
print(q)
# q <- q + transition_time(num) + labs(title = paste0("0daa: 11H28 - 11H30 ", "{frame_time}/", length(steps)))
# animate(q, nframes = max(steps)-min(steps)+1, fps = 5, renderer = gifski_renderer(loop = T),
#         width = 1500, height = 1000, res = 150)
# anim_save("fig/0daa_20211019_1128_1130.gif")
```

## dans le poche
```{r}
dat = data %>%
  filter(H==11 & M>=35 & M<=37)
dat$num = 1:nrow(dat)

steps = dat$num
q <- p +
  geom_point(data = dat, aes(x=x, y=y), col="red", size=0.5) +
  geom_point(data = coord1, aes(x=x,y=y), col = "black", size=1) +
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-15,10)) +
  labs(x="", y="", title = "0daa: 11H35 - 11H37")
print(q)
# q <- q + transition_time(num) + labs(title = paste0("0daa: 11H35 - 11H37 ", "{frame_time}/", length(steps)))
# animate(q, nframes = max(steps)-min(steps)+1, fps = 5, renderer = gifski_renderer(loop = T),
#         width = 1500, height = 1000, res = 150)
# anim_save("fig/0daa_20211019_1135_1137.gif")
```

## dessus de la tête
```{r}
dat = data %>%
  filter(H==11 & M>=38 & M<=40)
dat$num = 1:nrow(dat)

steps = dat$num
q <- p + 
  geom_point(data = dat, aes(x=x, y=y), col="red", size=0.5) + 
  geom_point(data = coord1, aes(x=x,y=y), col = "black", size=1) +
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-15,10)) + 
  labs(x="", y="", title = "0daa: 11H38 - 11H40")
print(q)
# q <- q + transition_time(num) + labs(title = paste0("0daa: 11H38 - 11H40 ", "{frame_time}/", length(steps)))
# animate(q, nframes = max(steps)-min(steps)+1, fps = 5, renderer = gifski_renderer(loop = T),
#         width = 1500, height = 1000, res = 150)
# anim_save("fig/0daa_20211019_1138_1140.gif")
```



# test 2
![](figure/Wire 2021-10-19 at 18_03.png){width=50%}

## contre le corps
```{r}
dat = data %>%
  filter(H==11 & M>=56 & M<=59)
dat$num = 1:nrow(dat)

steps = dat$num
q <- p + 
  geom_point(data = dat, aes(x=x, y=y), col="red", size=0.5) + 
  geom_point(data = coord2, aes(x=x,y=y), col = "black", size=1) +
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-15,10)) + 
  labs(x="", y="", title = "0daa: 11H56 - 11H59")
print(q)
# q <- q + transition_time(num) + labs(title = paste0("0daa: 11H56 - 11H59 ", "{frame_time}/", length(steps)))
# animate(q, nframes = max(steps)-min(steps)+1, fps = 5, renderer = gifski_renderer(loop = T),
#         width = 1500, height = 1000, res = 150)
# anim_save("fig/0daa_20211019_1156_1159.gif")
```

## dans le poche
```{r}
dat = data %>%
  filter(H==12 & M>=00 & M<=03)
dat$num = 1:nrow(dat)

steps = dat$num
q <- p + 
  geom_point(data = dat, aes(x=x, y=y), col="red", size=0.5) + 
  geom_point(data = coord2, aes(x=x,y=y), col = "black", size=1) +
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-15,10)) + 
  labs(x="", y="", title = "0daa: 12H00 - 12H03")
print(q)
# q <- q + transition_time(num) + labs(title = paste0("0daa: 12H00 - 12H03 ", "{frame_time}/", length(steps)))
# animate(q, nframes = max(steps)-min(steps)+1, fps = 5, renderer = gifski_renderer(loop = T),
#         width = 1500, height = 1000, res = 150)
# anim_save("fig/0daa_20211019_1200_1203.gif")
```

## dessus de la tête
```{r}
dat = data %>%
  filter(H==12 & M>=04 & M<=07)
dat$num = 1:nrow(dat)

steps = dat$num
q <- p + 
  geom_point(data = dat, aes(x=x, y=y), col="red", size=0.5) + 
  geom_point(data = coord2, aes(x=x,y=y), col = "black", size=1) +
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-15,10)) + 
  labs(x="", y="", title = "0daa: 12H04 - 12H07")
print(q)
# q <- q + transition_time(num) + labs(title = paste0("0daa: 12H04 - 12H07 ", "{frame_time}/", length(steps)))
# animate(q, nframes = max(steps)-min(steps)+1, fps = 5, renderer = gifski_renderer(loop = T),
#         width = 1500, height = 1000, res = 150)
# anim_save("fig/0daa_20211019_1204_1207.gif")
```



# test 3
![](figure/Wire 2021-10-19 at 22_26.png){width=50%}

## à la main en continu
```{r}
dat = data %>%
  filter(H==15 & M>=55 & M<=56)
dat$num = 1:nrow(dat)

steps = dat$num
q <- p + 
  geom_point(data = dat, aes(x=x, y=y), col="red", size=0.5) + 
  geom_point(data = coord3, aes(x=x,y=y), col = "black", size=1) +
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-15,10)) + 
  labs(x="", y="", title = "0daa: 15H55 - 15H56")
print(q)
# q <- q + transition_time(num) + labs(title = paste0("0daa: 15H55 - 15H56 ", "{frame_time}/", length(steps)))
# animate(q, nframes = max(steps)-min(steps)+1, fps = 5, renderer = gifski_renderer(loop = T),
#         width = 1500, height = 1000, res = 150)
# anim_save("fig/0daa_20211019_1555_1556.gif")
```

## dans le poche en continu
```{r}
dat = data %>%
  filter(H==15 & M>=57 & M<=58)
dat$num = 1:nrow(dat)

steps = dat$num
q <- p + 
  geom_point(data = dat, aes(x=x, y=y), col="red", size=0.5) + 
  geom_point(data = coord3, aes(x=x,y=y), col = "black", size=1) +
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-15,10)) + 
  labs(x="", y="", title = "0daa: 15H57 - 15H58")
print(q)
# q <- q + transition_time(num) + labs(title = paste0("0daa: 15H57 - 15H58 ", "{frame_time}/", length(steps)))
# animate(q, nframes = max(steps)-min(steps)+1, fps = 5, renderer = gifski_renderer(loop = T),
#         width = 1500, height = 1000, res = 150)
# anim_save("fig/0daa_20211019_1557_1558.gif")
```

## dessus de la tête en continu
```{r}
dat = data %>%
  filter(record_timestamp>=1634651940 & record_timestamp<=1634652060)
dat$num = 1:nrow(dat)

steps = dat$num
q <- p + 
  geom_point(data = dat, aes(x=x, y=y), col="red", size=0.5) + 
  geom_point(data = coord3, aes(x=x,y=y), col = "black", size=1) +
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-15,10)) + 
  labs(x="", y="", title = "0daa: 15H59 - 16H01")
print(q)
# q <- q + transition_time(num) + labs(title = paste0("0daa: 15H59 - 16H01 ", "{frame_time}/", length(steps)))
# animate(q, nframes = max(steps)-min(steps)+1, fps = 5, renderer = gifski_renderer(loop = T),
#         width = 1500, height = 1000, res = 150)
# anim_save("fig/0daa_20211019_1559_1601.gif")
```


## à la main sans continu
```{r}
dat = data %>%
  filter(H==16 & M>=38 & M<=40)
dat$num = 1:nrow(dat)

steps = dat$num
q <- p + 
  geom_point(data = dat, aes(x=x, y=y), col="red", size=0.5) + 
  geom_point(data = coord3, aes(x=x,y=y), col = "black", size=1) +
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-15,10)) + 
  labs(x="", y="", title = "0daa: 16H38 - 16H40")
print(q)
# q <- q + transition_time(num) + labs(title = paste0("0daa: 16H38 - 16H40 ", "{frame_time}/", length(steps)))
# animate(q, nframes = max(steps)-min(steps)+1, fps = 5, renderer = gifski_renderer(loop = T),
#         width = 1500, height = 1000, res = 150)
# anim_save("fig/0daa_20211019_1638_1640.gif")
```

## dans le poche sans continu
```{r}
dat = data %>%
  filter(H==16 & M>=41 & M<=43)
dat$num = 1:nrow(dat)

steps = dat$num
q <- p + 
  geom_point(data = dat, aes(x=x, y=y), col="red", size=0.5) + 
  geom_point(data = coord3, aes(x=x,y=y), col = "black", size=1) +
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-15,10)) + 
  labs(x="", y="", title = "0daa: 16H41 - 16H43")
print(q)
# q <- q + transition_time(num) + labs(title = paste0("0daa: 16H41 - 16H43 ", "{frame_time}/", length(steps)))
# animate(q, nframes = max(steps)-min(steps)+1, fps = 5, renderer = gifski_renderer(loop = T),
#         width = 1500, height = 1000, res = 150)
# anim_save("fig/0daa_20211019_1641_1643.gif")
```

## dessus de la tête sans continu
```{r}
dat = data %>%
  filter(H==16 & M>=44 & M<=47)
dat$num = 1:nrow(dat)

steps = dat$num
q <- p + 
  geom_point(data = dat, aes(x=x, y=y), col="red", size=0.5) + 
  geom_point(data = coord3, aes(x=x,y=y), col = "black", size=1) +
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-15,10)) + 
  labs(x="", y="", title = "0daa: 16H44 - 16H47")
print(q)
# q <- q + transition_time(num) + labs(title = paste0("0daa: 16H44 - 16H47 ", "{frame_time}/", length(steps)))
# animate(q, nframes = max(steps)-min(steps)+1, fps = 5, renderer = gifski_renderer(loop = T),
#         width = 1500, height = 1000, res = 150)
# anim_save("fig/0daa_20211019_1644_1647.gif")
```


# test 4
```{r}
data = read.csv2("data/json/2021-10-20/0daa.csv")
dat = data %>%
  filter(record_timestamp>=1634725980 & record_timestamp<=1634726220)
dat$num = 1:nrow(dat)

steps = dat$num
q <- p +
  geom_point(data = dat, aes(x=x, y=y), col="red", size=0.5) + 
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-20,20)) + 
  labs(x="", y="", title = "0daa: 12H33 - 12H36 at 20 oct 2021")
print(q)
# q <- q + transition_time(num) + labs(title = paste0("0daa: 12H33 - 12H36 at 20 oct 2021 - ", "{frame_time}/", length(steps)))
# animate(q, nframes = max(steps)-min(steps)+1, fps = 5, renderer = gifski_renderer(loop = T),
#         width = 1500, height = 1000, res = 150)
# anim_save("fig/0daa_20211020_1233_1236.gif")
```


# test ancre_tag_ancre
## 20211020: 14H19 - 14H35
```{r fig.width=9, fig.height=12}
json_data = fromJSON(file = paste0("data/json/2021-10-20/1400.json"))

dat <- data.frame(tag = unlist(lapply(json_data, function(x){x["tag_id"][[1]]})),
                  x = unlist(lapply(json_data, function(x){x["x"][[1]]})),
                  y = unlist(lapply(json_data, function(x){x["y"][[1]]})),
                  record_timestamp = unlist(lapply(json_data, function(x){x["record_timestamp"][[1]]})))
dat = dat[order(dat$record_timestamp),]
dat = cbind.data.frame(dat, convert_date(dat$record_timestamp))
dat$x = as.numeric(dat$x)
dat$y = as.numeric(dat$y)

names_tag <- read.table(file = "data/tag_names_20210924.txt", header = T, sep = "\t")

dat = dat[which(!dat$tag %in% names_tag$id), ]
dat = dat %>%
  filter(H==14 & M>=19 & M<=35)

dat$x = dat$x/100
dat$y = dat$y/100

q <- p +
  geom_point(data = dat, aes(x=x, y=y, col=tag), size = 0.5) +
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-40,40)) +
  labs(x="", y="", title = "20211020: 14H19 - 14H35")
q
```


## 20211022: 12H46 - 13H02
```{r}
json_data = fromJSON(file = paste0("data/json/2021-10-22/ancre_to_tag.json"))

dat <- data.frame(tag = unlist(lapply(json_data, function(x){x["tag_id"][[1]]})),
                  x = unlist(lapply(json_data, function(x){x["x"][[1]]})),
                  y = unlist(lapply(json_data, function(x){x["y"][[1]]})),
                  record_timestamp = unlist(lapply(json_data, function(x){x["record_timestamp"][[1]]})))
dat = dat[order(dat$record_timestamp),]
dat = cbind.data.frame(dat, convert_date(dat$record_timestamp))
dat$x = as.numeric(dat$x)
dat$y = as.numeric(dat$y)

names_tag <- read.table(file = "data/tag_names_20210924.txt", header = T, sep = "\t")

dat = dat[which(!dat$tag %in% names_tag$id), ]

dat$x = dat$x/100
dat$y = dat$y/100

q <- p +
  geom_point(data = dat, aes(x=x, y=y, col=tag), size = 0.5) +
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-40,40)) +
  labs(x="", y="", title = "20211022: 12H46 - 13H02")
q
```


## 20211022: 14H28 - 15H11
```{r}
json_data = fromJSON(file = paste0("data/json/2021-10-22/ancre_to_tag2.json"))

dat <- data.frame(tag = unlist(lapply(json_data, function(x){x["tag_id"][[1]]})),
                  x = unlist(lapply(json_data, function(x){x["x"][[1]]})),
                  y = unlist(lapply(json_data, function(x){x["y"][[1]]})),
                  record_timestamp = unlist(lapply(json_data, function(x){x["record_timestamp"][[1]]})))
dat = dat[order(dat$record_timestamp),]
dat = cbind.data.frame(dat, convert_date(dat$record_timestamp))
dat$x = as.numeric(dat$x)
dat$y = as.numeric(dat$y)

names_tag <- read.table(file = "data/tag_names_20210924.txt", header = T, sep = "\t")

dat = dat[which(!dat$tag %in% names_tag$id), ]

dat$x = dat$x/100
dat$y = dat$y/100

q <- p +
  geom_point(data = dat, aes(x=x, y=y, col=tag), size = 0.5) +
  coord_fixed(ratio = 1, xlim = c(-20,20), ylim = c(-40,40)) +
  labs(x="", y="", title = "20211022: 14H28 - 15H11")
q
```
